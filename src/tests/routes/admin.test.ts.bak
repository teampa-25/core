import request from "supertest";
import app from "@/app";
import { UserService } from "@/services/user.service";
import { StatusCodes } from "http-status-codes";
import TestMemory from "../shared";


describe("Admin route test", () => {

  it("should login admin and perform action", async () => {
    let res = await request(app).post("/api/auth/login").send({
      email: TestMemory.admin.email,
      password: TestMemory.admin.password,
    });

    expect(res.statusCode).toBe(StatusCodes.OK);
    expect(res.body).toHaveProperty("token");
    expect(res.body.token).toBeTruthy();
    expect(typeof res.body.token).toBe("string");

    TestMemory.runtime.adminToken = res.body.token;

    res = await request(app).post("/api/auth/register").send({
      email: TestMemory.user1.email,
      password: TestMemory.user1.password,
    });

    res = await request(app)
      .post("/api/admin/recharge")
      .set("Authorization", `Bearer ${TestMemory.runtime.adminToken}`)
      .send({ email: TestMemory.user1.email, credits: 100, });

    expect(res.statusCode).toBe(StatusCodes.OK);
    expect(res.body.newBalance).toBe(200);
  });

});
